# Lightweight Dockerfile for development
FROM python:3.11-slim

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Install poetry
RUN pip install poetry

# Set up pip cache for faster builds
ENV PIP_CACHE_DIR=/root/.cache/pip
ENV PIP_DISABLE_PIP_VERSION_CHECK=1

# Set workdir
WORKDIR /app

# Don't create a virtual environment
RUN poetry config virtualenvs.create false

# Copy only what's needed for poetry to install dependencies
COPY poetry.lock pyproject.toml ./

# Install dependencies
RUN poetry install --without dev

# Set environment variables
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1
# Set this to use a shared models directory
ENV HF_HOME=/models

# Expose port
EXPOSE 8000

# Start the application in development mode
CMD ["python", "-m", "audhd_lifecoach.main"]